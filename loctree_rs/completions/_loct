#compdef loct loctree
# Zsh completion for loct (loctree CLI)
# Install: cp _loct ~/.zsh/completions/ && compinit
# Or add to fpath: fpath=(~/.zsh/completions $fpath)

_loct() {
    local -a commands global_opts

    commands=(
        'auto:Auto-detect and scan project'
        'agent:Scan with AI agent optimizations'
        'scan:Scan project and save snapshot'
        'tree:Show directory tree with LOC'
        'slice:Extract file context for AI agents'
        'find:Find symbols across codebase'
        'dead:Find unused exports'
        'unused:Find unused exports (alias for dead)'
        'cycles:Find circular imports'
        'commands:Analyze Tauri commands'
        'events:Analyze Tauri events'
        'routes:Analyze routes'
        'info:Show project info'
        'lint:Run linter checks'
        'report:Generate HTML report'
        'help:Show help'
        'query:Quick queries (who-imports, where-symbol)'
        'impact:Show import impact of file'
        'diff:Compare snapshots'
        'memex:Memory/context export'
        'crowd:Find functionally similar files'
        'tagmap:Unified search by keyword'
        'twins:Find semantic duplicates'
        'suppress:Manage false positive suppressions'
        'dist:Bundle distribution analysis'
        'coverage:Code coverage analysis'
        'sniff:Detect code smells'
        'focus:Extract directory context'
        'hotspots:Import frequency analysis'
        'layoutmap:CSS layout analysis'
    )

    global_opts=(
        '--json[Output as JSON]'
        '--quiet[Suppress non-essential output]'
        '--verbose[Verbose output]'
        '--color[Color mode]:color:(auto always never)'
        '--library-mode[Treat as library (exports are public API)]'
        '--python-library[Treat as Python library]'
        '--py-root[Additional Python package root]:path:_files -/'
        '--help[Show help]'
        '--help-full[Show full help]'
        '--help-legacy[Show legacy help]'
        '--version[Show version]'
    )

    local curcontext="$curcontext" state line
    typeset -A opt_args

    _arguments -C \
        $global_opts \
        '1: :->command' \
        '*: :->args'

    case $state in
        command)
            _describe -t commands 'loct command' commands
            ;;
        args)
            case $line[1] in
                slice)
                    _arguments \
                        '--consumers[Include files that import target]' \
                        '--json[JSON output]' \
                        '--root[Project root]:path:_files -/' \
                        '--rescan[Force rescan before slice]' \
                        '--depth[Dependency depth limit]:number' \
                        '*:file:_files'
                    ;;
                find)
                    _arguments \
                        '--json[JSON output]' \
                        '--root[Project root]:path:_files -/' \
                        '--dead-only[Show only dead code]' \
                        '--symbol-only[Show only exact matches]' \
                        '--semantic-only[Show only semantic matches]' \
                        '*:pattern'
                    ;;
                dead|unused)
                    _arguments \
                        '--json[JSON output]' \
                        '--root[Project root]:path:_files -/' \
                        '--confidence[Confidence level]:level:(normal high)' \
                        '--full[Show all dead exports]'
                    ;;
                cycles)
                    _arguments \
                        '--json[JSON output]' \
                        '--root[Project root]:path:_files -/'
                    ;;
                commands)
                    _arguments \
                        '--json[JSON output]' \
                        '--missing[Show FE calls without BE handlers]' \
                        '--unused[Show handlers without FE calls]'
                    ;;
                events)
                    _arguments \
                        '--json[JSON output]'
                    ;;
                twins)
                    _arguments \
                        '--json[JSON output]' \
                        '--dead-only[Show only dead parrots]' \
                        '--include-suppressed[Include suppressed findings]' \
                        '--include-tests[Include test files]'
                    ;;
                crowd)
                    _arguments \
                        '--json[JSON output]' \
                        '--root[Project root]:path:_files -/' \
                        '*:pattern'
                    ;;
                tagmap)
                    _arguments \
                        '--json[JSON output]' \
                        '--root[Project root]:path:_files -/' \
                        '*:keyword'
                    ;;
                focus)
                    _arguments \
                        '--json[JSON output]' \
                        '--consumers[Include consumer files]' \
                        '--depth[Dependency depth limit]:number' \
                        '--root[Project root]:path:_files -/' \
                        '*:directory:_files -/'
                    ;;
                hotspots)
                    _arguments \
                        '--json[JSON output]' \
                        '--leaves[Show only leaf nodes]' \
                        '--coupling[Show coupling metrics]' \
                        '--min[Minimum importers]:number' \
                        '--limit[Limit results]:number' \
                        '--root[Project root]:path:_files -/'
                    ;;
                layoutmap)
                    _arguments \
                        '--json[JSON output]' \
                        '--zindex-only[Show only z-index values]' \
                        '--sticky-only[Show only sticky/fixed elements]' \
                        '--grid-only[Show only grid/flex layouts]' \
                        '--min-zindex[Minimum z-index value]:number' \
                        '*--exclude[Exclude glob pattern]:pattern' \
                        '--root[Project root]:path:_files -/'
                    ;;
                suppress)
                    _arguments \
                        '--list[List all suppressions]' \
                        '--clear[Clear all suppressions]' \
                        '--file[Suppress only in file]:path:_files' \
                        '--reason[Reason for suppression]:reason' \
                        '*:type:(twins dead_parrot)'
                    ;;
                scan)
                    _arguments \
                        '--json[JSON output]' \
                        '--full-scan[Force full scan]' \
                        '--watch[Watch mode]' \
                        '--root[Project root]:path:_files -/'
                    ;;
                lint)
                    _arguments \
                        '--fail[Exit with error on findings]' \
                        '--sarif[SARIF output]' \
                        '--json[JSON output]' \
                        '--root[Project root]:path:_files -/'
                    ;;
                report)
                    _arguments \
                        '--serve[Start local server]' \
                        '--port[Server port]:port' \
                        '--graph[Include dependency graph]' \
                        '--json[JSON output]' \
                        '--root[Project root]:path:_files -/' \
                        '*:output:_files'
                    ;;
                query)
                    _arguments \
                        '1:query type:(who-imports where-symbol component-of)' \
                        '*:file:_files'
                    ;;
                diff)
                    _arguments \
                        '--since[Compare with snapshot]:ref' \
                        '--json[JSON output]'
                    ;;
                dist)
                    _arguments \
                        '--json[JSON output]' \
                        '*:file:_files'
                    ;;
                impact)
                    _arguments \
                        '--json[JSON output]' \
                        '--depth[Depth limit]:number' \
                        '--root[Project root]:path:_files -/' \
                        '*:file:_files'
                    ;;
                help)
                    _describe -t commands 'command' commands
                    ;;
                *)
                    _files
                    ;;
            esac
            ;;
    esac
}

_loct "$@"
